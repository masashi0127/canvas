<!DOCTYPE html>
<html lang="utf-8">
<head>
<title>Insert title here</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<!--[if lt IE 9]>
	<script type="text/javascript" src="excanvas.min.js"></script>
<![endif]-->
<style type="text/css">
* {
	margin: 0;
	padding: 0;
}
</style>
<script type="text/javascript">
try {
	window.addEventListener('load', eventWindowLoaded, false);
} catch(e) {
	window.attachEvent('load', eventWindowLoaded);
}
function eventWindowLoaded() {
	canvasApp();
}

function object(o) {
	var f = object.f, i, len, n, prop;
	f.prototype = o;
	n = new f;
	for (i=1, len=arguments.length; i<len; ++i)
	for (prop in arguments[i])
	n[prop] = arguments[i][prop];
	return n;
}
object.f = function(){};

function canvasApp() {

	var LayoutTable = {
		start_x: 10,
		start_y: 10,
		end_x: 0,
		end_y: 0,
		padding_top: 3,
		padding_bottom: 3,
		padding_left: 3,
		padding_right: 3,
		font_size: 12,
		font_type: 'px monospace',
		time_block_width: 0,
		time_block_height: 0,
		date_block_width: 0,
		date_block_height: 0,
		arrTimeMemory: new Array(),
		arrDateMemory: new Array(),
		arrBlock: new Array(),

		setParam: function() {
			this.time_block_width = parseInt(ctx.measureText('00').width) + parseInt(this.padding_left) + parseInt(this.padding_right);
			this.time_block_height = parseInt(this.font_size) + parseInt(this.padding_top) + parseInt(this.padding_bottom);
			this.date_block_width = parseInt(ctx.measureText('0000/00/00').width) + parseInt(this.padding_left) + parseInt(this.padding_right);
			this.date_block_height = parseInt(this.font_size) + parseInt(this.padding_top) + parseInt(this.padding_bottom);
			console.log(this);
		}
	};

	var TimeMemory = {
		time: '',
		font_x: 0,
		font_y: 0,
		block_start_x: 0,
		block_start_y: 0,
		block_end_x: 0,
		block_end_y: 0,
		padding_left: 5,
		padding_right: 5,
		measure: '',

		setParam: function(time, pre_x, pre_y) {
			this.time = time
			this.measure = ctx.measureText(time);
			if(pre_x === 0 && pre_y === 0) {
				this.block_start_x = parseInt(objLayoutTable.start_x) + parseInt(objLayoutTable.date_block_width);
			} else {
				this.block_start_x = pre_x;

			}
			this.block_start_y = objLayoutTable.start_y;
			this.end_x += objLayoutTable.time_block_width;
			this.end_y = objLayoutTable.time_block_height;
			return [end_x + padding_right, end_y];
		},

		meDraw: function() {
			ctx.fillStyle = 'rgba(0, 0, 0, 1)';
			ctx.font = this.font_size + this.font_type;
			ctx.textBaseline = 'top';
			ctx.textAlign = 'center';
			ctx.strokeStyle = 'rgba(100, 0 , 0,1)';
			ctx.strokeRect(this.x - 20, this.y - 12, this.x, this.y);
			ctx.fillText(this.time, this.x, this.y);
		}
	};

	var DateMemory = {
		date: '',
		start_x: 0,
		start_y: 0,
		end_x: 0,
		end_y: 0,

		meDraw: function() {
			ctx.fillStyle = 'rgba(0, 0, 0, 1)';
			ctx.font = this.font_size + this.font_type;
			ctx.textBaseline = 'top';
			ctx.textAlign = 'left';
			ctx.fillText(this.date, this.x, this.y);
		}
	};

	var Block = {
		segment_count: 5,
		arrSegment: '',
		date: '',
		time: '',
		width: 50,
		heigth: 30,
		padding_top: 5,
		padding_bottom: 5,

		meDraw: function() {

			for(var i = 0; i < this.arrSegment.length; i++) {
				var objSegment = arrSegment[i];
				ctx.strokeStyle = 'rgba(255, 255, 255 ,1)';
				ctx.strokeRect(this.x, this.y, this.width, this.height);
				ctx.fillStyle = 'rgba(' + this.r + ', ' + this.g + ', ' + this.b + ', ' + this.a + ')';
				ctx.fillRect(this.x, this.y, this.width, this.height);
			}
		}
	};

	var Segment = {
		x: 75,
		y: 25,
		w: 0,
		h: 0,
		r: 0,
		g: 0,
		b: 0,
		a: 0,

		setColor: function(type) {
			if(type === 0) {
				this.r = 200;
				this.g = 200;
				this.b = 0;
				this.a = 1;
			} else if(type === 1) {
				this.r = 0;
				this.g = 200;
				this.b = 200;
				this.a = 1;
			} else if(type === 2) {
				this.r = 200;
				this.g = 0;
				this.b = 170;
				this.a = 1;
			} else if(type === 3) {
				this.r = 100;
				this.g = 200;
				this.b = 100;
				this.a = 1;
			}
		}
	};

	var arrData = {
		"2012/06/01": [
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0
		],
		"2012/06/02": [
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0
		],
		"2012/06/03": [
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0
		],
		"2012/06/04": [
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0
		],
		"2012/06/05": [
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0,0,0,
			0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,0,0,0
		]
	}

	var canvas = document.getElementById('canvas');
	var ctx = canvas.getContext('2d');
	var w = document.body.clientWidth;
	var h = document.body.clientHeight - 50;
	canvas.width = 1200;
	canvas.height = 1000;
	var objLayoutTable = object(LayoutTable);
	objLayoutTable.setParam();

	//createLayoutTable();
	//draw();

	function createLayoutTable() {
		for(var i = 0; i < 24; i++) {
			var objTimeMemory = object(TimeMemory);

		}
	}

	function draw() {
		for(date in arrData) {
			var segmentsData = arrData[date];
			var objBlock = object(Block);
			objBlock.arrSegment = new Array();
			var j = 0;
			for(var i = 0; i < objBlock.segment_count; i++) {
				var objSegment = object(Segment);
				objSegment.setColor(segmentsData[j]);
				objBlock.arrSegment.push(objSegment);
				j++;
			}
		}

	}
}
</script>
</head>
<body>
	<canvas id="canvas"></canvas>
</body>
</html>